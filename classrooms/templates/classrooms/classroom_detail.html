{% extends "base.html" %}
{% load cache %}


{% block sidebar-menu %}
{% cache 10 sidebar object.pk %}
    {% for klas in klassen %}
        <li {% if object == klas %} class="active" {% endif %}>
            <a href="{% url 'klas' klas %}">Klas {{klas}}</a>
        </li>
    {% endfor %}
{% endcache %}
{% endblock %}

{% block content %}

{% if object %}
{% cache 100 classroom object.pk %}
    <h2>Klas {{ object }}</h2>
    <div>
        <p style="float:left;">
            Klasleerkracht: {% for leerkracht in object.leerkracht.all %}
            {% if not forloop.first %} & {%endif%}
            <a href="{% url 'profile' leerkracht.pk %}">{{leerkracht}}</a>
            {%endfor%}
            <br />
            Klasouder(s): {% for klasouder in object.klasouders.all %}
            {% if not forloop.first %} & {%endif%}
            <a href="{% url 'profile' klasouder.pk %}">{{klasouder}}</a>
            {% endfor %}
            <br />
            Aantal leerlingen: {{ students|length }}
        </p>
        <p style="float:right;margin-right:10px;">
            {% if request.user.is_klasouder or request.user.is_medewerker or request.user.is_staff  or request.user.is_superuser %}
            <i class="fa fa-long-arrow-right" aria-hidden="true"></i> <a href="mailto:?BCC= {{all_email}}">
            Verstuur e-mail naar alle ouders + klasleerkracht</a>
            {% endif %}
        </p>
    </div>
    <div style="clear:both;"></div>
    <table>
        <tbody>
            
            {% for student in students %}
                <div style="display:none">{% cycle 'even' 'odd' as rowcolors %}</div>
                    {% for parent in student.parents.all %}
                    <tr class="{{ rowcolors }}">
                        <td>{% if forloop.first %}{{ student }}{% endif %}</td>
                        <td>{% if parent.overleden %}
                                {{ parent|safe }}
                            {% else %}
                                <a href="{% url 'profile' parent.pk %}"/>{{ parent|safe }}</a>
                            {% endif %}
                        </td>
                        <td>{{ parent.gsm }}</td>
                        <td>{{ parent.email }}</td>
                        <td>
                            {% ifchanged %}
                                {{ parent.get_address }}
                            {% endifchanged %}
                        </td>
                        <td>
                            {% ifchanged %}
                                {{ parent.get_postcode }} {{ parent.get_gemeente|lower|capfirst }}
                            {% endifchanged %}
                        </td>
                        <td>
                            {% ifchanged %}
                                {{ parent.telefoon }}
                            {% endifchanged %}
                        </td>
                    </tr>
                    {% empty %}
                        <tr class="{{ rowcolors }}">
                            <td>{{ student }}</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    {% endfor %}
            {% endfor %}
        </tbody>
    </table>
{% endcache %}
{% else %}
<h2>Geen klassen gevonden</h2>
{% endif %}    
{% endblock %}